<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui" xmlns:H="http://java.sun.com/jsf/html">

<f:view>
    <h:head>
        <title>Главная</title>
        <h:outputStylesheet library="css" name="style.css"/>
    </h:head>

    <svg id="area" width="300px" height="300px" xmlns="http://www.w3.org/2000/svg" version="1.1"/>

    <h:body>
        <!-- В эту форму будет записываться значение -->
        Это спрятано V
        <h:form id="main-form" style="/*display: none*/">

            <p>
                X:
                <!-- Первая типо выбрана сейчас -->
                <h:commandButton styleClass="button-selected" id="x-5" value="-5" onclick="return setX(-5)"/>
                <c:forEach var="i" begin="0" end="7" step="1">
                    <h:commandButton
                            styleClass="button"
                            id="x#{-4 + i}"
                            value="#{-4 + i}"
                            onclick="return setX(#{-4 + i})"/>
                </c:forEach>
            </p>


            <p>
                Y:
                <h:inputText value="10"
                             converterMessage="Y must be number..."
                             validatorMessage="Y must be number between -5 and 5 inclusive"
                             required="true" requiredMessage="Y is required" maxlength="6">
                    <f:validateDoubleRange minimum="-3" maximum="3"/>
                    <!-- Хз что это за хрень -->
                    <f:ajax execute="@form" render="y-error"/>
                </h:inputText>
            </p>

            <p>
                R:
                <p:commandLink id="r1" styleClass="link-selected" value="1" onclick="return setR(1)"/>
                <c:forEach var="i" begin="2" end="5" step="1">
                    <p:commandLink id="r#{i}" styleClass="link" value="#{i}" onclick="return setR(#{i})"/>
                </c:forEach>
            </p>
            <h:inputHidden id="r-hidden" value="#{indexBean.r}" required="true"
                           requiredMessage="Выберите R"/>


            <h:inputText id="x" value="#{indexBean.x}"/>
            <h:inputText id="y" value="#{indexBean.y}"/>
            <h:inputText id="r" value="#{indexBean.r}"/>
            <h:commandButton
                    id="submit-button"
                    styleClass="hidden-submit-btn"
                    action="#{indexBean.submitCoordinates}"
                    value="поставить точку"
                    update="@main-form result-table"/>
        </h:form>

        <!-- Hidden storage (спрятанное хранилище) -->
        <div>
            <table id="result-table">
                <tr class="table-header">
                    <th class="coords-col">X</th>
                    <th class="coords-col">Y</th>
                    <th class="coords-col">R</th>
                    <th class="time-col">Время запроса</th>
                    <th class="hitres-col">Попадание</th>
                </tr>
                <ui:repeat value="#{indexBean.points}" var="point">
                    <tr class="#{point.hit? 'hit-yes': 'hit-no'}">
                        <td class="table-x-value">#{point.x}</td>
                        <td class="table-y-value">#{point.y}</td>
                        <td class="table-r-value">#{point.r}</td>
                        <td>point.currentTime</td>
                        <td class="table-hit-value">#{(point.hit ? '✅' : '❌')}</td>
                    </tr>
                </ui:repeat>
            </table>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js" type="text/javascript"></script>
        <script src="https://d3js.org/d3.v7.min.js" type="text/javascript"></script>
        <h:outputScript library="js" name="graph.js"/>
        <h:outputScript library="js" name="script.js" />
    </h:body>
</f:view>

</html>
